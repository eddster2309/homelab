- name: Create IP Tables forwarding rule
  ansible.builtin.iptables:
    table: nat
    chain: PREROUTING
    protocol: tcp
    match: tcp
    destination_port: 443
    jump: REDIRECT
    to_ports: 8200

- name: Save current state of the firewall in system file
  community.general.iptables_state:
    state: saved
    path: "{{ configure_vault_iptables_config_path }}"

- name: Template IPtables Restore
  ansible.builtin.template:
    src: iptables-restore.service.j2
    dest: /etc/systemd/system/iptables-restore.service
    mode: '0644'
    owner: root
    group: root

- name: Enable iptables service
  ansible.builtin.systemd_service:
    name: iptables-restore
    daemon_reload: true
    enabled: true
